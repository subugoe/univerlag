(function(){var t,e,i,r,o,n;n={addToCartButtons:$(".access.order"),itembox:$(".item-wrapper, #aspect_artifactbrowser_ItemViewer_div_item-view"),cssPath:"/static/shopping-cart/css/",i18nPath:"/static/shopping-cart/i18n/",pluginPath:"/static/shopping-cart/plugins/",templatePath:"/static/shopping-cart/templates/",currencySymbol:"&euro;",language:"Deutsch"===$("#langopt").text()?"en":"de",orderUrl:"/order",shippingUrl:"/costrequest"},i={},i.options=n,$(function(){var t;return t=i,document.createStyleSheet?document.createStyleSheet(t.options.cssPath+"shopping-cart.css"):$("head").append("<link rel='stylesheet' type='text/css' href='"+t.options.cssPath+"shopping-cart.css'>"),$.when($.get(t.options.templatePath+"infobox.html"),$.get(t.options.templatePath+"form.html"),$.getJSON(t.options.i18nPath+"countries."+t.options.language+".json")).done(function(i,n,s){var a;return $("body").append(i[0],n[0]),t.scope=$(".shopping-cart"),"de"!==t.options.language&&t.scope.find("[data-"+t.options.language+"]").each(function(){var e,i,r,o,n;for(o=this.childNodes,n=[],e=0,i=o.length;i>e;e++){if(r=o[e],"#text"===r.nodeName&&null!==r.nodeValue){r.nodeValue=$(this).data(t.options.language);break}n.push(void 0)}return n}),$('select[data-model="countrycode"]',t.scope).each(function(){var t,e,i,r,o;$(this).append($("<option/>")),i=s[0],r=[];for(t in i)o=i[t],e=$("<option/>").attr("value",t).text(o),r.push($(this).append(e));return r}),$.getScript(t.options.pluginPath+"chosen/chosen.jquery.min.js",function(){return $('select[data-model="countrycode"]').chosen({placeholder_text_single:" "})}),t.view=new o,t.storage=new r,a=t.storage.read(),a?(t.order=a,t.order.updateShipping()):(t.order=new e,$(":input[data-default]",t.scope).each(function(){return $(this).val($(this).data("default")),$(this).change()})),t.view.update()})}),Number.prototype.toCurrency=function(){var t,e;return t=i,e=t.options.currencySymbol+"&nbsp;"+this.toFixed(2),null!=t.options.language&&"de"===t.options.language&&(e=e.replace(".",",")),e},$.fn.extend({animateflyTo:function(t){return this.each(function(){var e,i;return i=$(this),e=i.clone(),e.css({background:"#eee",overflow:"hidden",position:"fixed",right:$(window).width()-i.offset().left-i.outerWidth(),top:i.offset().top-$(window).scrollTop(),width:i.width()}),e.insertAfter(i).animate({right:$(window).width()-t.offset().left-t.outerWidth(),top:t.offset().top-$(window).scrollTop(),width:t.outerWidth(),height:t.outerHeight(),opacity:.5},"slow",function(){return e.fadeOut(200,function(){return e.remove()}),t.flash()})})},flash:function(t){return null==t&&(t=!1),this.each(function(){return t?$(this).stop(!0,!0).fadeIn():$(this).stop(!0,!0).fadeOut(100).fadeIn(100).fadeOut(100).fadeIn(100)})},highlightIfEmpty:function(){var t;return t=!0,this.each(function(){var e;return e=$(this).closest("fieldset"),0===$(this).val().length||$(this).is(":checkbox")&&!$(this).prop("checked")?($(this).addClass("error"),e.addClass("error"),t=!1,void 0):($(this).removeClass("error"),e.removeClass("error"))}),t}}),t=function(){function t(t){this.uuid=t,this.amount=0,this.contributor=0,this.description="",this.id=0,this.part="",this.quantity=1,this.shipping=0,this.sum=0,this.title="&mdash;"}var e;return e=i,t.prototype.setAmount=function(t){return this.amount=t,this.sum=this.quantity*t},t}(),e=function(){function t(){this.count=0,this.customer={},this.customer.equalsDelivery=!0,this.delivery={},this.items=[],this.shipping=0,this.sent=!1,this.subtotal=0,this.total=0}var e;return e=i,t.prototype.addItem=function(t,i){var r;return null==i&&(i=!0),this.sent=!1,r=this.items.map(function(t){return t.uuid}).indexOf(t.uuid),0>r?(this.items.push(t),this.count+=t.quantity,this.subtotal+=t.sum):this.items[r].quantity<99&&(this.items[r].quantity++,this.count++,this.items[r].sum+=this.items[r].amount,this.subtotal+=this.items[r].amount),i?(this.updateShipping(),e.view.update(),e.storage.update(this)):void 0},t.prototype.removeItem=function(t,i){var r;return null==i&&(i=!1),r=this.items.map(function(t){return t.uuid}).indexOf(t),i?(this.count-=this.items[r].quantity,this.subtotal-=this.items[r].sum,this.items.splice(r,1)):this.items[r].quantity>1&&(this.items[r].quantity--,this.items[r].sum-=this.items[r].amount,this.count--,this.subtotal-=this.items[r].amount),this.updateShipping(),e.view.update(),e.storage.update(this)},t.prototype.removeAllItems=function(){return this.items=[],this.count=0,this.shipping=0,this.subtotal=0,this.total=0,e.view.update(),e.storage.update(this)},t.prototype.submit=function(){var t,i;return(i=$(":input[required]:visible",e.scope).highlightIfEmpty())?(t=JSON.parse(JSON.stringify(this)),t.customer.name=t.customer.firstname+" "+t.customer.lastname,t.customer.country=$("select[data-model='countrycode']:eq(0) option[value='"+t.customer.countrycode+"']").text(),this.customer.equalsDelivery?delete t.delivery:(t.delivery.name=t.delivery.firstname+" "+t.delivery.lastname,t.delivery.country=$("select[data-model='countrycode']:eq(0) option[value='"+t.delivery.countrycode+"']").text()),$.each(t.items,function(e,i){return t.items[e].id=i.id.toString(),t.items[e].quantity=i.quantity.toString()}),$.ajax({type:"POST",url:e.options.orderUrl,contentType:"application/x-www-form-urlencoded",data:{order:JSON.stringify(t)}}).done(function(t){return function(i){var r,o;return r=i.indexOf("{"),r&&(i=i.substring(r)),o=JSON.parse(i),"true"===o.success?(t.sent=!0,t.removeAllItems(),e.view.message("orderReceived","success")):e.view.message("orderInvalid","error","<br>"+o.error)}}(this)).fail(function(t){return function(t){return e.view.message("unexpectedSubmitError","error")}}(this))):void e.view.message("fillAllFields","warning")},t.prototype.updateShipping=function(){var t,i,r;return 0===this.count?void(this.shipping=0):(i={},i.countrycode=e.order.customer.equalsDelivery?e.order.customer.countrycode:e.order.delivery.countrycode,i.items=[],$.each(e.order.items,function(t,e){var r;return r={},r.id=e.id.toString(),r.quantity=e.quantity.toString(),r.part=e.part,i.items.push(r)}),r=0,t=this.shipping,$.ajax({type:"POST",url:e.options.orderUrl,contentType:"application/x-www-form-urlencoded",data:{costrequest:JSON.stringify(i)}}).done(function(i){return function(o){var n;return n=o.indexOf("{"),n&&(o=o.substring(n)),r=JSON.parse(o),null!=r.shipping&&parseFloat(r.shipping)>=0&&"-"!==r.shipping.substring(0,1)?(i.shipping=parseFloat(r.shipping.replace(",",".")),i.total=parseFloat(r.total.replace(",",".")),i.shipping!==t&&e.view.message("shippingUpdated","temp")):(e.view.message("shippingCalculationError","error"),i.shipping=!1,i.total=!1),e.view.update()}}(this)).fail(function(i){return e.view.message("shippingCalculationError","error"),this.shipping=!1,this.total=!1,this.shipping!==t?e.view.update():void 0}))},t}(),r=function(){function t(){}return t.prototype.read=function(){var t,i,r,o,n,s;if(null!=localStorage.order){if(s=JSON.parse(localStorage.order),o=new e,o.customer=s.customer,o.delivery=s.delivery,null!=s.items)for(n=s.items,i=0,r=n.length;r>i;i++)t=n[i],o.addItem(t,!1);return o}return!1},t.prototype.update=function(t){return localStorage.order=JSON.stringify(t)},t}(),o=function(){function e(){var e,i;i=$(".shopping-cart.infobox:first"),e=$(".shopping-cart.form:first"),i.click(function(){return e.fadeIn(),$("html, body").animate({scrollTop:0})}),$(".close.form",r.scope).click(function(t){return e.fadeOut()}),$("body").click(function(){return $(".close.form",r.scope).click()}),$(".shopping-cart").click(function(t){return t.stopPropagation()}),$("div.conditions",r.scope).hide().append($("<div/>").load(r.options.i18nPath+"conditions."+r.options.language+".html")),$(".show.conditions").click(function(){return $("div.conditions:hidden").slideDown(),!1}),$(".close.conditions").click(function(){return $("div.conditions").slideUp(),!1}),r.options.addToCartButtons.click(function(){var e,o,n,s;return o=$(this),s=o.data("id")+o.data("part"),n=new t(s),n.id=o.data("id"),n.part=o.data("part"),n.contributor=o.data("contributor"),n.description=o.data("description"),n.title=o.data("title"),n.setAmount(+o.data("amount").toString().replace(",",".")),r.order.addItem(n),e=$(this).closest(r.options.itembox),e.animateflyTo(i),!1}),$("button",r.scope).click(function(t){return t.preventDefault()}),$(".remove",r.scope).click(function(){var t;return t=$(this).closest(".item").attr("data-item-uuid"),r.order.removeItem(t,!0),!1}),$(".less, .more",r.scope).click(function(){var e,i;return i=$(this).closest(".item").attr("data-item-uuid"),$(this).hasClass("less")?r.order.removeItem(i):(e=new t(i),r.order.addItem(e)),!1}),$(":input[data-model]",r.scope).change(function(){var t,e,i,o,n;switch($(this).val($(this).val().trim()),n=$(this).attr("data-model"),o=$(this).closest("fieldset").attr("data-entity"),r.order[o][n]=$(this).is(":checkbox")?$(this).prop("checked"):$(this).val(),r.storage.update(r.order),$(this).is("[required]")&&$(this).highlightIfEmpty(),n){case"equalsDelivery":if(e=$(this).prop("checked"),t=$('[data-entity="delivery"]',r.scope),e?(t.slideUp(),t.find(".error").removeClass("error"),t.find(":input[data-model][required]").prop("required",!1).attr("data-required","")):(t.slideDown(),t.find(":input[data-model][data-required]").prop("required",!0).removeData("required")),r.order.customer.countrycode!==r.order.delivery.countrycode)return r.order.updateShipping();break;case"countrycode":if("customer"!==o)return r.order.updateShipping();if(r.order.customer.equalsDelivery)return i=$("[data-entity=delivery] :input[data-model=countrycode]",r.scope),i.val($(this).val()),i.change().trigger("chosen:updated")}}),$(".submit",r.scope).click(function(){return r.order.submit()})}var r,o;return r=i,o=null,e.prototype.message=function(t,e,i){var r,n,s,a;return null==e&&(e="success"),null==i&&(i=""),$(".message").hide(),$(".countdown").remove(),n=$(".message#"+t),n.flash("success"===e),clearInterval(o),"temp"===e?(r=$('<div class="countdown"/>'),n.append(r),s=7500,a=0,o=setInterval(function(){return a+=50,r.css("width",a/s*100+"%"),a===s-1e3&&n.stop(!0,!0).fadeOut(1e3),a>=s?clearInterval(o):void 0},50)):void 0},e.prototype.update=function(){var t,e,i,o,n,s,a,u,d,c;for($(".item:first",r.scope).hide(),$(".item:gt(0)",r.scope).remove(),$(".sc-in-cart").removeClass("sc-in-cart"),e=$('[data-model="equalsDelivery"]').prop("checked"),e!==r.order.customer.equalsDelivery&&$('[data-model="equalsDelivery"]').prop("checked",r.order.customer.equalsDelivery).change(),0===r.order.items.length&&$(".message",r.scope).stop(!0,!0).fadeOut(1e3),a=r.order.items,o=0,n=a.length;n>o;o++)i=a[o],t=$(".item:first",r.scope).clone(!0),t.attr("data-item-uuid",i.uuid),$('[data-model="contributor"]',t).html(i.contributor),$('[data-model="description"]',t).html(i.description),$('[data-model="title"]',t).html(i.title),$('[data-model="quantity"]',t).html(i.quantity),$('[data-model="amount"]',t).html(i.amount.toCurrency()),$('[data-model="sum"]',t).html(i.sum.toCurrency()),t.appendTo(".items tbody").show(),r.options.addToCartButtons.filter("[data-id='"+i.id+"'][data-part='"+i.part+"']").addClass("sc-in-cart");$('[data-model="count"]',r.scope).html(r.order.count),$('[data-model="subtotal"]',r.scope).html(r.order.subtotal.toCurrency()),$('[data-model="shipping"]',r.scope).html(r.order.shipping!==!1?r.order.shipping.toCurrency():"?"),$('[data-model="total"]',r.scope).html(r.order.total!==!1?r.order.total.toCurrency():"?"),u=r.order.customer;for(s in u)c=u[s],$("[data-entity='customer'] [data-model='"+s+"']",r.scope).val(c);d=r.order.delivery;for(s in d)c=d[s],$("[data-entity='delivery'] [data-model='"+s+"']",r.scope).val(c);return $(".disable-if-empty",r.scope).prop("disabled",r.order.count<1),$(".show-if-sent",r.scope).each(function(){return $(this).toggle(r.order.sent===!0&&0===r.order.count)}),$(".show-if-empty",r.scope).each(function(){return $(this).toggle(r.order.sent===!1&&0===r.order.count)}),$(".show-if-filled",r.scope).each(function(){return $(this).toggle(r.order.count>0)}),$(".show-if-one",r.scope).each(function(){return $(this).toggle(1===r.order.count)}),$(".show-if-multiple",r.scope).each(function(){return $(this).toggle(r.order.count>1)}),$("select",r.scope).trigger("chosen:updated")},e}()}).call(this);
